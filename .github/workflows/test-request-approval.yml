# Request approval using external config from jamengual/.github
name: Request Approval (External Config)

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version for approval (e.g., v1.0.0)'
        required: true
        type: string
      workflow_name:
        description: 'Environment/Workflow to deploy'
        required: true
        default: 'deploy'
        type: choice
        options:
          - deploy        # Progressive pipeline (dev → qa → stage → prod)
          - deploy-dev    # Individual: DEV only
          - deploy-qa     # Individual: QA only
          - deploy-stage  # Individual: STAGING only
          - deploy-prod   # Individual: PRODUCTION only
          - release       # Release approval

permissions:
  contents: write
  issues: write
  pull-requests: read  # Required for PR tracking in pipeline workflows

jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Use the local action (current repo) with external config
      - uses: ./
        id: approval
        with:
          action: request
          workflow: ${{ inputs.workflow_name }}
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          config_repo: jamengual/.github

      - name: Output Results
        env:
          ISSUE_NUM: ${{ steps.approval.outputs.issue_number }}
          ISSUE_URL: ${{ steps.approval.outputs.issue_url }}
          STATUS: ${{ steps.approval.outputs.status }}
        run: |
          echo "## Approval Request Created" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Issue:** #${ISSUE_NUM}" >> $GITHUB_STEP_SUMMARY
          echo "- **URL:** ${ISSUE_URL}" >> $GITHUB_STEP_SUMMARY
          echo "- **Status:** ${STATUS}" >> $GITHUB_STEP_SUMMARY
          echo "- **Config Source:** jamengual/.github/enterprise-approval-engine_approvals.yml" >> $GITHUB_STEP_SUMMARY
